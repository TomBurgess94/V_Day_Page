<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1.0">
  <title>I Love You</title>
  <link rel="stylesheet" href="styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500&family=Dancing+Script:wght@600&display=swap" rel="stylesheet">
</head>

<body>
  <div class="center">
    <div>
      <p> Will you be my Valentine? </p>

      <div class="buttons">
        <button class="btnNo">No </button>
        <button onclick="document.location='message.html'" class="btnYes">Yes </button>
      </div>
  </div>
</div>
<div id="videoContainer"></div>
</div>
  <script>
    let count = 0;
const noBtn = document.querySelector(".btnNo");

["mouseover", "touchstart"].forEach(evt => {
  noBtn.addEventListener(evt, function (e) {

  // Only move the button if count is less than 3
  if (count < 3) {
    if(evt === "touchstart") e.preventDefault();
    count++;
    
    const rect = noBtn.getBoundingClientRect();
      const btnWidth = noBtn.offsetWidth;
      const btnHeight = noBtn.offsetHeight;

      // Calculate how much space is actually available around the button
      // We add a 10px buffer so it doesn't touch the very edge
      const availableLeft = -rect.left + 10;
      const availableRight = window.innerWidth - rect.right - 10;
      const availableTop = -rect.top + 10;
      const availableBottom = window.innerHeight - rect.bottom - 10;

      // Pick a random distance within the allowed range
      const moveX = Math.random() * (availableRight - availableLeft) + availableLeft;
      const moveY = Math.random() * (availableBottom - availableTop) + availableTop;

      // Current translation + the new random delta
      // We use getComputedStyle to keep track of previous jumps
      const style = window.getComputedStyle(noBtn);
      const matrix = new WebKitCSSMatrix(style.transform);
      
      const finalX = matrix.m41 + moveX;
      const finalY = matrix.m42 + moveY;

      noBtn.style.transform = `translate(${finalX}px, ${finalY}px)`;
  }
});
});

// The "Final Trap" Click
noBtn.addEventListener("click", function () {
  if (count >= 3) {
    triggerTreason();
  }
});

function triggerTreason() {
  // 1. Theme Change
  document.body.classList.add("treason");

  // 2. Show Container
  const videoBox = document.getElementById("videoContainer");
  videoBox.classList.add("show-video");

  // 3. Inject Video with SOUND (mute=0)
  // Since they clicked the button, the browser allows sound!
  const videoID = "R3oSAVwcD4U";
  videoBox.innerHTML = `
  <iframe 
    src="https://www.youtube.com/embed/${videoID}?autoplay=1&mute=0" 
    frameborder="0" allow="autoplay; encrypted-media" allowfullscreen>
  </iframe>`;
}
  </script>

</body>
</html>